# Cloudflare D1 Database Manager - Wrangler Configuration Template
# Copy this file to wrangler.toml and customize for your Cloudflare account
#
# NOTE: This is the PRODUCTION configuration.
# For local development, use wrangler.dev.toml instead.

name = "d1-manager"
main = "worker/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

# Smart Placement disabled for SPA - UI responsiveness priority
placement = { mode = "off" }

[build]
command = "npm run build"
cwd = "."

[assets]
directory = "dist"
binding = "ASSETS"

# ============================================
# D1 METADATA DATABASE CONFIGURATION
# ============================================
# This database stores query history and saved queries
# Create database: wrangler d1 create d1-manager-metadata
# Then run: wrangler d1 execute d1-manager-metadata --remote --file=worker/schema.sql
[[d1_databases]]
binding = "METADATA"
database_name = "d1-manager-metadata"  # CHANGE THIS
database_id = "your-metadata-database-id"  # CHANGE THIS (from wrangler d1 create output)

# ============================================
# R2 BACKUP BUCKET (OPTIONAL)
# ============================================
# R2 bucket for database backups
# Create bucket: wrangler r2 bucket create d1-manager-backups
[[r2_buckets]]
binding = "BACKUP_BUCKET"
bucket_name = "d1-manager-backups"  # CHANGE THIS

# ============================================
# DURABLE OBJECTS
# ============================================
# Durable Object for async backup operations
[[durable_objects.bindings]]
name = "BACKUP_DO"
class_name = "BackupDO"
script_name = "d1-manager"

[[migrations]]
tag = "v2_backup_do"
new_classes = ["BackupDO"]

# ============================================
# SCHEDULED BACKUPS (OPTIONAL)
# ============================================
# Cron trigger for scheduled R2 backups
# Runs hourly to check for and execute due scheduled backups
# Configure backup schedules per-database in the UI
[triggers]
crons = ["0 * * * *"]  # Every hour at minute 0

# ============================================
# OBSERVABILITY (OPTIONAL)
# ============================================
# Enable OpenTelemetry export for traces and logs
# Create destinations in Cloudflare Dashboard: Workers > Observability > Pipelines
# Common OTLP endpoints:
#   Grafana Cloud: https://otlp-gateway-{region}.grafana.net/otlp/v1/traces
#   Sentry: https://{HOST}/api/{PROJECT_ID}/integration/otlp/v1/traces
#   Datadog: https://otlp.{SITE}.datadoghq.com/v1/logs

[observability]
enabled = true

[observability.logs]
enabled = true
# Uncomment and set your log destination name from Cloudflare Dashboard
# destinations = ["your-logs-destination"]

# [observability.traces]
# enabled = true
# destinations = ["your-traces-destination"]

# ============================================
# CUSTOM DOMAIN ROUTING (OPTIONAL)
# ============================================
# Option 1: Use default Workers.dev subdomain (no configuration needed)
#   Your worker will be available at: https://d1-manager.<your-subdomain>.workers.dev
#
# Option 2: Use custom domain (uncomment and configure below)
#   Requirements:
#   - Domain must be added to your Cloudflare account
#   - DNS must be managed by Cloudflare
#
# [[routes]]
# pattern = "your-subdomain.your-domain.com"  # CHANGE THIS
# custom_domain = true
# zone_name = "your-domain.com"               # CHANGE THIS

# ============================================
# REQUIRED SECRETS (Set via CLI)
# ============================================
# Run these commands to set your secrets:
#
#   wrangler secret put ACCOUNT_ID
#   wrangler secret put CF_EMAIL
#   wrangler secret put API_KEY
#   wrangler secret put TEAM_DOMAIN
#   wrangler secret put POLICY_AUD
#
# Secret details:
# - ACCOUNT_ID: Your Cloudflare account ID (Dashboard > Overview)
# - CF_EMAIL: Your Cloudflare account email
# - API_KEY: Cloudflare API token with D1 permissions
# - TEAM_DOMAIN: Cloudflare Zero Trust team domain (e.g., yourteam.cloudflareaccess.com)
# - POLICY_AUD: Access Policy AUD tag from your Access application
#
# ============================================
# LOCAL DEVELOPMENT
# ============================================
# For local development, use wrangler.dev.toml instead of this file.
# See README.md "Local Development" section for instructions.
#
# Quick start:
#   Terminal 1: npm run dev
#   Terminal 2: npx wrangler dev --config wrangler.dev.toml --local

