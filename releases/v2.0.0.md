# D1 Manager v2.0.0 Release Notes

**Release Date:** December 5, 2025  
**Status:** Production/Stable  
**Type:** Major Release

---

## üöÄ Overview

This major release transforms D1 Database Manager into an enterprise-ready solution with Drizzle ORM integration, scheduled R2 backups, a comprehensive metrics dashboard, and dramatic performance improvements. No breaking changes - all new features are additive.

> **‚¨ÜÔ∏è Upgrading from v1.x?** If you want to use R2 backup features (scheduled backups, backup before delete/rename), you need to add a **Durable Object binding** to your `wrangler.toml`. See the [Upgrading section in README.md](https://github.com/neverinfamous/d1-manager#%EF%B8%8F-upgrading) for step-by-step instructions. Docker users can skip this - Durable Objects only apply to Cloudflare Workers deployments.

---

## ‚ú® Major Features

### Drizzle ORM Console

- **Introspect** - Pull schema from D1 database and generate Drizzle TypeScript schema
- **Migration Status** - View applied Drizzle migrations and migration history
- **Generate** - Upload or paste Drizzle schema to preview migration SQL
- **Push** - Push schema changes directly to database (with dry-run option)
- **Check** - Validate schema against current database state
- **Export** - Download generated schema as `schema.ts` TypeScript file
- Schema viewer with syntax highlighting and copy-to-clipboard
- Output log panel showing command execution history
- Automatic cache invalidation after push

### Scheduled R2 Backups

- Configure daily, weekly, or monthly backup schedules per database
- Backups run automatically via Cloudflare Workers cron triggers (hourly check)
- Choose specific day of week for weekly backups, day of month for monthly
- Select backup hour (0-23 UTC) for precise scheduling
- Enable/disable schedules without deleting configuration
- View last run status (success/failed), next run time, and backup history
- New "Schedule" tab in Backup & Restore dialog

### Metrics Dashboard

- **Summary cards** - Total queries (reads/writes), rows read, average P90 latency, total storage
- **Time range selector** - Last 24 hours, 7 days, or 30 days
- **Query volume trend chart** - Shows reads and writes over time
- **Rows read trend chart** - Important for billing visibility
- **Per-database breakdown** - Horizontal bar charts
- Lightweight SVG-based charts (no heavy chart library dependencies)
- Full accessibility: screen reader support, keyboard navigation, WCAG-compliant contrast
- 2-minute caching per time range

### Unified Backup & Restore Hub

- Replaces separate Undo History and R2 Restore dialogs with a single, tabbed interface
- **Quick Restore Tab** - Undo recent destructive operations
- **R2 Backups Tab** - Full database snapshots stored in R2 cloud storage
- **Schedule Tab** - Configure automated backup schedules per database
- Multi-select capability for bulk download and bulk delete
- Source tags show backup origin (Manual, Before Rename, Before STRICT Mode, Scheduled)
- **Orphaned Backups Section** - View and restore backups from deleted databases

### Comprehensive Safety Backups

- **Delete Database** - Creates R2 backup before deletion
- **Rename Database** - Creates R2 backup before rename operation
- **Delete Table** - Creates undo snapshot for quick restore
- **Enable STRICT Mode** - Creates R2 backup before table conversion
- **Modify Column** - Creates undo snapshot before schema changes
- **FTS5 Conversion** - Creates undo snapshot when converting FTS5 tables

---

## ‚ö° Performance Improvements

### ER Diagram Load Optimization

- Single API call instead of N+1 calls
- **60-70% faster** load times for databases with many tables

### Index Analyzer Optimization

- Parallel batch processing: 5 tables at a time
- Client-side caching with 60-second TTL

### Comprehensive Client-Side Caching

- **Tables Tab** - 5-minute cache for instant tab switching
- **Table Schema** - 5-minute cache, invalidated on column modifications
- **Foreign Keys** - 5-minute cache, invalidated on FK modifications
- **R2 Backup Status** - 10-minute cache shared across all components
- **FTS5 Manager** - 5-minute cache, invalidated on create/delete
- **Time Travel** - 5-minute cache, invalidated on capture/delete
- **Replication** - 5-minute cache, invalidated on mode change
- **Metrics** - 2-minute cache per time range

---

## üé® UI/UX Improvements

- **Database & Table List Views** - Toggle between grid and list view
- **Fullscreen Mode for Graphs** - FK Editor and ER Diagram fullscreen toggle
- **Enhanced Job History** - Full date/time display, duration column, progress percentage
- **External Documentation Links** - Quick-access buttons in header
- **Sticky Navigation & Jump to Top** - Fixed header with backdrop blur
- **Expanded Color Picker** - 27 colors organized by hue family
- **Always-Visible Undo History** - Header badge with total undo count
- **Error Support Links** - All errors include mailto link

---

## üîß API Changes

### New Endpoints

- `GET /api/metrics?range=24h|7d|30d` - D1 analytics via GraphQL
- `GET /api/scheduled-backups` - List scheduled backups
- `POST /api/scheduled-backups` - Create/update scheduled backup
- `DELETE /api/scheduled-backups/:dbId` - Delete scheduled backup
- `POST /api/drizzle/:dbId/introspect` - Generate Drizzle schema
- `GET /api/drizzle/:dbId/migrations` - Migration status
- `POST /api/drizzle/:dbId/push` - Push schema changes
- `POST /api/drizzle/:dbId/check` - Validate schema
- `GET /api/drizzle/:dbId/export` - Export schema file
- `GET /api/r2-backup/orphaned` - List orphaned backups
- `DELETE /api/r2-backup/:databaseId/bulk` - Bulk delete backups
- `GET /api/tables/:dbId/:tableName/strict-check` - STRICT mode validation

### Centralized Error Logging

- Converted 337+ ad-hoc console statements to use centralized error logger
- Module-prefixed error codes for easy identification

---

## üì¶ Upgrade Instructions

1. **Pull the latest changes**:

   ```bash
   git pull origin main
   npm install
   ```

2. **Add Durable Object binding** (for R2 backups):

   ```toml
   [[durable_objects.bindings]]
   name = "BACKUP_DO"
   class_name = "BackupDO"
   script_name = "d1-manager"

   [[migrations]]
   tag = "v2_backup_do"
   new_classes = ["BackupDO"]
   ```

3. **Deploy**:
   ```bash
   npm run build
   npx wrangler deploy
   ```

---

## üìö Documentation

- **[Changelog](https://github.com/neverinfamous/d1-manager/wiki/Changelog)** ‚Äî Detailed list of changes
- **[Wiki](https://github.com/neverinfamous/d1-manager/wiki)** ‚Äî Updated guides for new features

---

**Made with ‚ù§Ô∏è for the Cloudflare community**
